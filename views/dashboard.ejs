<div class="flex">
    <a href="/dashboard" class="py-2 text-center w-[125px] text-[#075640] font-bold <%= whatif ? '' : 'border-b-2 border-[#075640]' %> hover:bg-slate-100">Academic</a>
    <a href="/dashboard?whatif=true" class="py-2 text-center w-[125px] text-[#075640] font-bold <%= whatif ? 'border-b-2 border-[#075640]' : '' %> hover:bg-slate-100">What-if</a>
</div>

<% if (!whatif) { %>

<div class="p-[20px]">
    <!-- Student Information and Degree Completion Section -->
    <div style="display: flex; justify-content: space-between; background-color: #e0e0e0; padding: 20px;">
        <div>
        <p><strong>Student Name :</strong> <%= student.student_name %></p>
        <p><strong>Major:</strong> <%= student.major %></p>
        <p><strong>Concentration:</strong> <%= student.concentration %></p>
        <p><strong>Degree Type:</strong> <%= student.degree_type %></p>
        <p><strong>Advisor:</strong> <%= student.advisor %></p>
        <p><strong>Email:</strong> <%= student.email %></p>
        <p><strong>Classification:</strong> <%= student.classification %></p>
        <p><strong>Student ID:</strong> <%= student.studentid %></p>
        </div>
        <div style="text-align: center;">
            <div style="width: 100px; height: 100px; border-radius: 50%; background-color: lightgrey; display: inline-block; position: relative;">
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 20px;">50%</div>
            </div>
            <p>Degree Completion</p>
        </div>
    </div>

    <!-- General Education and Major Information Section -->
    <div style="padding: 20px;">
        <h2>General Education:</h2>
        <ul>
            <li>✔ DEVELOPMENT OF FUNDAMENTAL SKILLS OF INQUIRY</li>
            <li>✔ INQUIRY OF THE SCIENCES</li>
            <li>✔ THEMES OF LIBERAL EDUCATION FOR PRIVATE AND PUBLIC LIFE</li>
            <li>✔ CRITICAL THINKING AND COMMUNICATION</li>
        </ul>

        <h2>Major in Computer Science:</h2>
        <ul>
            <li>✔ CORE COURSES</li>
            <li>✔ Communication Skills</li>
        </ul>
    </div>

    <h2>Courses for <%= student.concentration %>:</h2>
    
    <div>
        <table class="table-fixed" style="width: 100%; text-align: left;">
            <thead>
                <tr style="font-weight: bold;">
                    <th>Course</th>
                    <th>Credit Hours</th>
                    <th>Grade Obtained</th>
                    <th>Future Grade</th>
                </tr>
            </thead>
            <tbody>
                <% courses.forEach(course => { %>
                    <tr>
                        <td><%= course.name %></td>
                        <td><%= course.credits %></td>
                        <td><%= course.grade_obtained %></td>
                        <td><%= course.future_grade %></td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    </div>
 
    <div>
        <table class="table-fixed" style="width: 100%; text-align: left;">
            <thead>
                <tr style="font-weight: bold;">
                    <th>Course</th>
                    <th>Title</th>
                    <th>Grade</th>
                    <th>Credit Hours</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

    <!-- Course Table -->
    <div class="px-[20x]">
        <table class="table-fixed" style="width: 100%; text-align: left;">
            <thead>
                <tr style="font-weight: bold;">
                    <th>Course</th>
                    <th>Title</th>
                    <th>Grade</th>
                    <th>Credit Hours</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

    </div>
    <!-- GPA Calculation Section -->
    <h2 class="p-[20px]">Calculate Your Semester GPA</h2>
    <form id="gpaForm" class="p-[20px]">
        <table style="width: 100%;">
            <tr>
                <th>Course Subject/No. (Optional)</th>
                <th>Credit Hours</th>
                <th>Grade</th>
                <th>Quality Points</th>
            </tr>
            <!-- Row 1 -->
            <tr>
                <td><input type="text" name="course1" placeholder="Course 1"></td>
                <td><input type="number" name="credit1" min="0" step="1" placeholder="Credit Hours" class="credits"></td>
                <td><input type="text" name="grade1" placeholder="Grade (A, B, C...)" class="grades"></td>
                <td><input type="text" name="quality1" placeholder="Calculated Quality Points" readonly class="quality-points"></td>
            </tr>
            <!-- Row 2 -->
            <tr>
                <td><input type="text" name="course2" placeholder="Course 2"></td>
                <td><input type="number" name="credit2" min="0" step="1" placeholder="Credit Hours" class="credits"></td>
                <td><input type="text" name="grade2" placeholder="Grade" class="grades"></td>
                <td><input type="text" name="quality2" placeholder="Calculated Quality Points" readonly class="quality-points"></td>
            </tr>
            <!-- Add more rows as needed -->
        </table>

        <div>
            <label for="totalQuality">Total Quality Points:</label>
            <input type="text" id="totalQuality" name="totalQuality" readonly>
        </div>
        <div>
            <label for="totalGPAHours">Total GPA Hours:</label>
            <input type="text" id="totalGPAHours" name="totalGPAHours" readonly>
        </div>
        <div>
            <label for="gpa">GPA:</label>
            <input type="text" id="gpa" name="gpa" readonly>
        </div>

        <button type="submit">Submit</button>
    </form>

    <!-- Link to GPA Algorithm JavaScript -->
    <script src="/js/gpa-algorithms.js"></script>

    <!-- Script to Dynamically Update GPA -->
    <script>
        document.querySelectorAll('.grades, .credits').forEach(input => {
            input.addEventListener('input', calculateGPA);
        });

        function calculateGPA() {
            const credits = document.querySelectorAll('.credits');
            const grades = document.querySelectorAll('.grades');
            const qualityPointsFields = document.querySelectorAll('.quality-points');

            let totalQualityPoints = 0;
            let totalCredits = 0;

            credits.forEach((creditInput, index) => {
                const credit = parseFloat(creditInput.value) || 0;
                const grade = grades[index].value.toUpperCase();

                // Calculate quality points (credit hours * grade point value)
                const gradePoints = gradeToPoints(grade);
                const qualityPoints = gradePoints * credit;

                if (!isNaN(qualityPoints)) {
                    qualityPointsFields[index].value = qualityPoints.toFixed(2);
                }

                totalQualityPoints += qualityPoints;
                totalCredits += credit;
            });

            // Update total quality points and GPA hours
            document.getElementById('totalQuality').value = totalQualityPoints.toFixed(2);
            document.getElementById('totalGPAHours').value = totalCredits.toFixed(2);

            // Calculate GPA
            const gpa = totalQualityPoints / totalCredits || 0;
            document.getElementById('gpa').value = gpa.toFixed(2);
        }

        // Function to convert grade to points
        function gradeToPoints(grade) {
            switch(grade) {
                case 'A': return 4.0;
                case 'B': return 3.0;
                case 'C': return 2.0;
                case 'D': return 1.0;
                case 'F': return 0;
                default: return 0;
            }
        }
    </script>
</div>

<% } else { %>
<div class="p-[20px] flex gap-4">
    <div class="flex gap-2 items-center">
        <i class="fa-solid fa-circle-check text-[#075640]"></i>
        <h1 class="text-[#075640]">Completed</h1>
    </div>
    <div class="flex gap-2 items-center">
        <i class="fa-solid fa-circle-half-stroke text-blue-800"></i>
        <h1 class="text-[#075640]">In-progress</h1>
    </div>
</div>
<div class="p-[20px] flex justify-center text-white">
    <div class="w-11/12 bg-[#075640] rounded-lg p-4">
        <h1 class="text-2xl font-semibold">Progress</h1>
        <form action="/dashboard" method="get">
            <div class="flex gap-4 p-2">
                <div>
                    <p class="italic">Catalog Year *</p>
                    <input disabled class="px-4 py-2 w-[280px] rounded-lg border-2 border-white" value="2024-2025" />
                </div>
                <div>
                    <p class="italic">Degree Year *</p>
                    <input class="px-4 py-2 w-[280px] rounded-lg border-2 border-white" type="text" disabled value="<%= student.degree_type === 'BS' ? 'Bachelor Of Science' : 'Bachelor of Arts'%>" />
                </div>
            </div>
            <div class="flex gap-4 p-2">
                <div>
                    <p class="italic">Program *</p>
                    <select class="px-4 py-2 w-[280px] rounded-lg bg-[#075640] border-2 border-white">
                        <option>Option 1</option>
                        <option>Option 2</option>
                        <option>Option 3</option>
                    </select>
                </div>
                <div>
                    <p class="italic">College *</p>
                    <input class="px-4 py-2 w-[280px] rounded-lg border-2 border-white" type="text" disabled value="Computing & Informatics" />
                </div>
            </div>
            <div class="flex p-2 justify-between items-end">
                <div>
                    <p class="italic">Level *</p>
                    <input class="px-4 py-2 w-[280px] rounded-lg border-2 border-white" type="text" disabled value="Undergraduate" />
                </div>
                <input type="submit" value="Process" class="px-2 py-1 font-semibold bg-white text-[#075640] rounded-lg hover:cursor-pointer text-xl" />
            </div>
        </form>
    </div>
</div>
<% } %>