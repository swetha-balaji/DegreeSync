<div class="flex">
    <a href="/dashboard" class="py-2 text-center w-[125px] text-[#075640] font-bold <%= whatif ? '' : 'border-b-2 border-[#075640]' %> hover:bg-slate-100">Academic</a>
    <a href="/dashboard?whatif=true" class="py-2 text-center w-[125px] text-[#075640] font-bold <%= whatif ? 'border-b-2 border-[#075640]' : '' %> hover:bg-slate-100">What-if</a>
</div>

<% if (!whatif) { %>
    <div class="w-full grid grid-cols-4 p-[20px]">
        <div class="flex flex-col">
            <h1 class="italic text-2xl">Degree Progress</h1>
            <div class="flex items-center justify-evenly mt-4">
                <div style="
                    width: 120px;
                    height: 120px;
                    border-radius: 50%;
                    background: conic-gradient(#075640 <%= (parseFloat(student.credits / 120) * 100).toFixed(0) %>%, lightgrey <%= (parseFloat(student.credits / 120) * 100).toFixed(0) %>%);
                    display: inline-block;
                    position: relative;
                ">
                    <div style="
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        font-size: 20px;
                        color: #FFFFFF;
                        font-weight: bold;
                    ">
                        <%= (parseFloat(student.credits / 120) * 100).toFixed(0) %>%
                    </div>
                </div>
                <div class="text-center text-[#075640]">
                    <h1 class="text-2xl font-bold">
                        <%= student.gpa ? student.gpa.toFixed(2) : "N/A" %>
                    </h1>
                    <h2 class="text-lg">Overall GPA</h2>
                </div>
            </div>
        </div>
    </div>
    
  
        
        <div class="col-span-3 flex flex-col justify-center gap-2">
            <div id="comp-sci-dropdown" class="flex w-5/6 h-[125px] bg-[#075640] rounded-lg items-center hover:cursor-pointer">
                <div class="flex flex-col w-full gap-2">
                    <div class="flex items-center w-full">
                        <div class="flex flex-1 gap-2 items-center text-white pl-3">
                            <h1 class="text-2xl font-bold p-1">Major in Computer Science</h1>
                            <h1 class="p-1 border-2 rounded-lg border-white">IN-PROGRESS</h1>
                        </div>
                        <i id="angle-1" class="fa-solid fa-angle-down pr-8 text-white text-2xl"></i>
                    </div>
                </div>
            </div>

            <div id="comp-sci-shown" class="w-5/6 p-4 bg-[#075640] hidden rounded-lg">
                <div class="text-white">
                    <table class="table-auto border-separate border-spacing-1 border-spacing-y-[20px]">
                        <thead class="font-bold">
                            <th>Complete</th>
                            <th>Course</th>
                            <th>Credits</th>
                            <th>Prerequisites</th>
                            <th>Grade</th>
                        </thead>
                        <tbody>

                <% majorCourses.forEach((course)=>{ %>
                    <% if (!course.is_capstone) { %>
                        <tr class="bg-white rounded-lg text-[#075640]">
                            <td class="p-1 text-center"><i class="fa-regular fa-circle text-red-800"></i></td>
                            <td class="p-1 text-center"><%= course.classno %> - <%= course.name %></td>
                            <td class="p-1 text-center"><%= course.credits %></td>
                            <td class="p-1 text-center"><%= course.prereq ? course.prereq : "None" %></td>
                            <td class="p-1 text-center"><input value="" placeholder="--" pattern="[ABCDF]" required class="w-[25px] text-center"/></td>
                        </tr>
                    <% } %>
                <% }) %>

                <tr class="text-2xl text-center font-bold"><td class="text-nowrap">Capstone (Select one)</td></tr>
                

                <% majorCourses.forEach((course)=>{ %>
                    <% if (course.is_capstone) { %>
                                <tr class="bg-white rounded-lg text-[#075640]">
                                    <td class="p-1 text-center"><i class="fa-regular fa-circle text-red-800"></i></td>
                                    <td class="p-1 text-center"><%= course.classno %> - <%= course.name %></td>
                                    <td class="p-1 text-center"><%= course.credits %></td>
                                    <td class="p-1 text-center"><%= course.prereq ? course.prereq : "None" %></td>
                                    <td class="p-1 text-center"><input value="" placeholder="--" pattern="[ABCDF]" required class="w-[25px] text-center"/></td>
                    <% } %>
                <% }) %>

                        </tbody>
                    </table>
                </div>
            </div>
            <div id="concentration-dropdown" class="flex w-5/6 h-[125px] bg-[#075640] rounded-lg items-center hover:cursor-pointer">
                <div class="flex flex-col w-full gap-2">
                    <div class="flex items-center w-full">
                        <div class="flex flex-1 gap-2 items-center text-white pl-3">
                            <h1 class="text-2xl font-bold p-1">Concentration in <%= student.concentration %></h1>
                            <h1 class="p-1 border-2 rounded-lg border-white">IN-PROGRESS</h1>
                        </div>
                        <i id="angle-2" class="fa-solid fa-angle-down pr-8 text-white text-2xl"></i>
                    </div>
                </div>
            </div>
            <div id="concentration-shown" class="w-5/6 p-4 bg-[#075640] hidden">
                <h1>Concentration Dropdown</h1>
            </div>
        </div>
    </div>
    </div>
</div>

        <!-- JavaScript for GPA Calculation -->
        <script>
            const credits = document.querySelectorAll('.credits');
            const grades = document.querySelectorAll('.grades');

            credits.forEach(input => input.addEventListener('input', calculateGPA));
            grades.forEach(input => input.addEventListener('input', calculateGPA));

            function calculateGPA() {
                let totalQualityPoints = 0;
                let totalCredits = 0;

                credits.forEach((creditInput, index) => {
                    const credit = parseFloat(creditInput.value) || 0;
                    const grade = grades[index].value;
                    const qualityPoints = getQualityPoints(grade) * credit;

                    totalQualityPoints += qualityPoints;
                    totalCredits += credit;
                });

                document.getElementById('gpa').value = totalCredits ? (totalQualityPoints / totalCredits).toFixed(2) : 0; // Calculate GPA only
            }

            function getQualityPoints(grade) {
                switch (grade.toUpperCase()) {
                    case 'A': return 4.0;
                    case 'B': return 3.0;
                    case 'C': return 2.0;
                    case 'D': return 1.0;
                    case 'F': return 0.0;
                    default: return 0.0; // Assume 0 for unrecognized grades
                }
            }
        </script>
    </div>



    <style>
        .collapsible {
            cursor: pointer;
            padding: 10px;
            border: 1px solid #ddd;
            background-color: #075640;
            color: white;
            margin-top: 5px;
            border-radius: 5px;
        }

        .collapsible-content {
            display: none;
            overflow: hidden;
            padding: 10px 20px;
            background-color: #075640;
            border: 1px solid #ddd;
        }

        .class-container {
            margin-top: 10px;
            background-color: #e0e0e0;
            padding: 10px;
            border-radius: 5px;
            color:#075640;
        }
    </style>
</div>
<% } else { %>
<div class="p-[20px] flex gap-4">
    <div class="flex gap-2 items-center">
        <i class="fa-solid fa-circle-check text-[#075640]"></i>
        <h1 class="text-[#075640]">Completed</h1>
    </div>
    <div class="flex gap-2 items-center">
        <i class="fa-regular fa-circle text-red-800"></i>
        <h1 class="text-[#075640]">Incomplete</h1>
    </div>
</div>
<div class="p-[20px] flex justify-center text-white">
    <div class="w-11/12 bg-[#075640] rounded-lg p-4">
        <h1 class="text-2xl font-semibold">Progress</h1>
        <form action="/dashboard" method="get">
            <div class="flex gap-4 p-2">
                <div>
                    <p class="italic">Catalog Year *</p>
                    <input disabled class="px-4 py-2 w-[280px] rounded-lg border-2 border-white" value="2024-2025" />
                </div>
            </div>
            <div class="flex gap-4 p-2 items-end">
                <div>
                    <p class="italic">Program *</p>
                    <select class="px-2 py-2 w-[280px] rounded-lg bg-[#075640] border-2 border-white truncate">
                        <option>AI, Robotics and Gaming - B.S.</option>
                        <option>Bioinformatics - B.S.</option>
                        <option>Cybersecurity - B.S.</option>
                        <option>Data Science - B.S.</option>
                        <option>Systems and Networks - B.S.</option>
                        <option>Web/Mobile Development and Software Engineering - B.S.</option>
                        <option>Human-Computer Interaction - B.A.</option>
                        <option>Information Technology - B.A.</option>
                        <option>Bioinformatics - B.A.</option>
                    </select>
                </div>
                <div class="flex justify-between items-end w-full">
                    <div class="">
                        <p class="italic">Level *</p>
                        <input class="px-4 py-2 w-[280px] rounded-lg border-2 border-white" type="text" disabled value="Undergraduate" />
                    </div>
                    <input type="submit" value="Process" class="mx-2 px-2 py-1 font-semibold bg-white text-[#075640] rounded-lg hover:cursor-pointer text-xl" />
                </div>
            </form>
        </div>
    </div>
</div>
<% } %>
<script src="/js/index.js"></script>